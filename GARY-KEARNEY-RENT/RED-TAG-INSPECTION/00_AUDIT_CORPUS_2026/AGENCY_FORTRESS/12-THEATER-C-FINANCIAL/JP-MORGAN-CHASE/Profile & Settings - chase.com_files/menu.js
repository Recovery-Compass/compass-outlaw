define(["require","appkit-utilities/view/webSpecUtil","common/lib/viewHelper/viewMixins","blue/siteMode","common/lib/emulationUtils","profileArea/sharedLib/apptelTracker","profileArea/sharedLib/profileUtil","blue/hash","profileArea/core/template/menu","bluespec/my_profile_menu","blue-ui/view/modules/dropdown","blue-ui/view/modules/navMenu"],(function(e){"use strict";var t=e("appkit-utilities/view/webSpecUtil"),i=e("common/lib/viewHelper/viewMixins"),n=e("blue/siteMode"),a=e("common/lib/emulationUtils"),s=e("profileArea/sharedLib/apptelTracker"),o=e("profileArea/sharedLib/profileUtil"),r=e("blue/hash");return function(u){this.template=e("profileArea/core/template/menu"),this.viewName="ProfileMenuView";var l=this;i.applyTriggerBuilderMixin(this),this.onInit=function(){this.triggerBuilder.addSECTriggerFilters([{EC_onMenuItemInteract:this.EC_onMenuItemInteract},"EC_skipMenu","EC_skipBackMenu"]),this.bridge=Object.assign(t.createWebSpec(e("bluespec/my_profile_menu"),{triggers:{...this.triggerBuilder.getTriggers(),menuClickExitDialog:{}},preventDefault:!1}),{stopPropagation:!1,bindings:{hubNavigationEnabled:{}}}),this.model.menuAttributes=null,this.views={blueDropdown:e("blue-ui/view/modules/dropdown"),blueNavMenu:e("blue-ui/view/modules/navMenu")},this.partials={},this.setMenuColumns()},this.onReady=function(){i.addFocusHandler(this),this.onData("hubNavigationEnabled",this.setMenuColumns),this.onData("profileMenuOptions",this.disableMenuOptions),u.page.broadcast("setHeader")},this.setMenuColumns=function(e){this.model.menuColumns="col-md-3 hide-xs-only show-md",e&&(this.model.menuColumns="col-md-12",u.$("#profileMenuLink-myProfileOverview").focus())},this._isDisabledByRoles=function(e){return!e.isEnabled&&!l.model.roles[e.route.action.name]},this._isDisabledByECD=function(e){return e.isECDDisabled},this._isDisabledByEmulationMode=function(e){return e.isDisabledByEmulationMode},this._isDisabledByReadOnly=function(e){return!e.isReadOnlyEnabled},this.EC_onMenuItemInteract=function(e){var t=this;function i(){var i=e.context.route;s.logEnterAction(i.action.name),t.trigger(i.action.name,i)}switch(e.context.level){case"subcategory":this.model.activeMenuCategoryId&&this.model.activeMenuCategoryId!==e.context.id&&this.trigger("collapseMenuCategory",e),this.trigger(e.context.active?"collapseMenuCategory":"expandMenuCategory",e);break;case"bottom":var n=r.getCanonicalRoute();o.pageUsesAppkitDirtyForm(n)?i():this.trigger("menuClickExitDialog",i)}},this.onMenuItemInteract=this.EC_onMenuItemInteract,this.disableMenuOptions=function(e){if(e){var t=[this._isDisabledByRoles];n.isModeEnabled("readOnly")&&t.push(this._isDisabledByReadOnly),n.isModeEnabled("ecdStandIn")&&t.push(this._isDisabledByECD),a.isEmulationMode()&&t.push(this._isDisabledByEmulationMode),e.forEach((function(e){e.data?e.data.forEach((function(e){e.disabled=t.some((function(t){return t(e)}))})):e.disabled=t.some((function(t){return t(e)}))})),this.setMenuAttributes(e)}},this.setMenuAttributes=function(e){var t=u.util.array.flatten;this.model.menuAttributes=t((e||[]).map((function(e){return e.data||[]}))).reduce((function(e,t){var i="#bottom-"+t.id;return e.push({target:i,attrName:"data-attr",attr:"MY_PROFILE_MENU."+t.titleSetting}),e.push({target:i,attrName:"exit",attr:"myProfile."+t.route.action.name}),e.push({target:i,attrName:"data-navmenu",attr:"true"}),e}),[])}}}));