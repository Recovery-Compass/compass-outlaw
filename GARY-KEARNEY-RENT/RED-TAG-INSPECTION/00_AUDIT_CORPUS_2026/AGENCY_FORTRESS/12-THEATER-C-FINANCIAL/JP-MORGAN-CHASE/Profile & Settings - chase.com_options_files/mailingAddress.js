define(["require","blue/$","profileArea/sharedLib/profileConstants","common/lib/focusUtil","moment","appkit-utilities/common/mediaQueryListener","blue/root","common/lib/elementObserver","profileArea/personalDetails/mailingAddress/webspec/mailingAddress","bluespec/my_profile_address","profileArea/sharedLib/genericServiceErrorEvent","profileArea/personalDetails/mailingAddress/template/mailingAddress","profileArea/personalDetails/mailingAddress/template/partials/mailingAddressView","profileArea/personalDetails/mailingAddress/template/partials/addressSection","profileArea/personalDetails/mailingAddress/template/partials/addressList","profileArea/personalDetails/mailingAddress/template/partials/mailingAddressEdit","profileArea/sharedLib/sharedView/template/genericErrorMessage","profileArea/sharedLib/sharedView/transition/scrollToTop","profileArea/sharedLib/sharedView/transition/focusOnRender","profileArea/sharedLib/sharedView/transition/attributeInjector","common/lib/transition/motionHandler","profileArea/personalDetails/mailingAddress/lib/validators/effectiveDateValidator","profileArea/personalDetails/mailingAddress/lib/validators/endDateValidator","profileArea/sharedLib/sharedView/decorators/decorator","profileArea/personalDetails/mailingAddress/lib/validators/accountSelectedValidator","profileArea/personalDetails/mailingAddress/lib/validators/dirtyFormValidator","profileArea/personalDetails/mailingAddress/lib/validators/recurrenceDateValidator","profileArea/sharedLib/sharedView/decorators/screenTakeover","blue-ui/view/elements/alert","blue-ui/view/elements/radiobutton","blue-ui/view/elements/checkbox","blue-ui/view/elements/input","blue-ui/view/elements/fieldlabel","blue-ui/view/elements/button","blue-ui/view/elements/accessible","profileArea/sharedLib/sharedView/customTooltip","profileArea/sharedLib/sharedView/dashboardStyledSelectWrapper/view","blue-ui/view/elements/iconwrap","blue-ui/view/elements/inlinemodalheader","profileArea/sharedLib/sharedView/dashboardLinkWrapper/view","blue-ui/view/modules/validationdatepicker","blue-ui/view/elements/skiplink","blue-ui/view/elements/stickyfooter","blue-ui/view/modules/tooltip","blue-ui/view/elements/loader","blue-ui/view/elements/link"],(function(e){"use strict";var i=e("blue/$"),a=e("profileArea/sharedLib/profileConstants"),l=a.ACCOUNT_GROUP,t=e("common/lib/focusUtil"),r=e("moment"),s=e("appkit-utilities/common/mediaQueryListener"),n=e("blue/root"),o=e("common/lib/elementObserver");return function(d){var m=this;m.bridge=e("profileArea/personalDetails/mailingAddress/webspec/mailingAddress"),m.compSpec=e("bluespec/my_profile_address"),m.compSpecValidationName="mailingAddresses",m.elementObserver=new o,m.setMinEndDate=function(){if(m.model.mailingAddressEffectiveDate?.length){var e=r(m.model.mailingAddressEffectiveDate).add(1,"days").format("L");m.model.minimumTemporaryEndDate=e}},m.onInit=function(){m.model={allBankAccountsChecked:!1,allBankAccountsDisabled:!1,allInvestmentAccountsChecked:!1,allInvestmentAccountsDisabled:!1,minimumTemporaryEndDate:""},m.helpers={ADDRESS_CATEGORY_TYPES:a.ADDRESS_CATEGORY_TYPES,MAILING_ADDRESS_CATEGORY:a.MAILING_ADDRESS_CATEGORY,ADDRESS_LAYOUT_MODE:a.ADDRESS_LAYOUT_MODE},m.context.util.object.extend(m.model,m.helpers),e("profileArea/sharedLib/genericServiceErrorEvent").viewListenGeneric(m),m.bridge.on("trigger/setFocus",(function(e){e.element?"FORM"===e.element.nodeName?m.context.$(e.element).find('button[type="submit"]').focus():m.context.$(e.element).focus():e.elementData&&"EDIT"===e.elementData.elementType&&m.context.$("#mailing-address-"+e.elementData.addressId+" .action-link.edit").focus()})),m.bridge.on("trigger/disableDatePickerTextInput",(function(){function e(e){m.elementObserver.isInsertedPromise(`.${e}`).then((function(){document.getElementsByClassName(e)[0].querySelector("input").setAttribute("disabled",!0)}))}e("mailing-address-effective-date"),e("mailing-address-end-date")})),i(".overlay").show(),m.bridge.on("trigger/updateViewModel",(function(e){var i=e.message;i.type===l.BANK_ACCOUNT?(m.model.allBankAccountsChecked=i.checked,m.model.allBankAccountsDisabled=m.model.allBankAccountsChecked&&i.disabled):i.type===l.INVESTMENT_ACCOUNT?(m.model.allInvestmentAccountsChecked=i.checked,m.model.allInvestmentAccountsDisabled=m.model.allInvestmentAccountsChecked&&i.disabled):(m.model.allBankAccountsChecked=m.model.allInvestmentAccountsChecked=!1,m.model.allBankAccountsDisabled=m.model.allInvestmentAccountsDisabled=!1)}));m.onData("showLoader",(function(){t.scrollToTopOfPage()})),m.onData("mailingAddressEffectiveDate",m.setMinEndDate),m.model.submitButtonDisabled=!0,m.model.isXS=s.currentBreakpoint===s.BREAKPOINT.XS,i(n).on("breakpoint-change.phoneView",function(){this.model.isXS=s.currentBreakpoint===s.BREAKPOINT.XS}.bind(this)),m.onData("caasBlockInView",(function(e){var i=document.getElementById("dashboard-content"),a=document.getElementById("flyoutWrapper"),l=document.getElementById("applicationOverlay");e?(i&&i.style&&(i.style.display="none"),a&&a.classList&&a.classList.add("miscHide")):(i&&i.style&&(i.style.display="block"),a&&a.classList&&a.classList.remove("miscHide"),l&&(l.innerHTML=""))}),{init:!1})},m.template=e("profileArea/personalDetails/mailingAddress/template/mailingAddress"),m.partials={mailingAddressView:e("profileArea/personalDetails/mailingAddress/template/partials/mailingAddressView"),addressSection:e("profileArea/personalDetails/mailingAddress/template/partials/addressSection"),addressList:e("profileArea/personalDetails/mailingAddress/template/partials/addressList"),mailingAddressEdit:e("profileArea/personalDetails/mailingAddress/template/partials/mailingAddressEdit"),genericErrorMessage:e("profileArea/sharedLib/sharedView/template/genericErrorMessage")},m.transitions={scrollToTop:e("profileArea/sharedLib/sharedView/transition/scrollToTop"),focusOnRender:e("profileArea/sharedLib/sharedView/transition/focusOnRender"),injectAttributes:e("profileArea/sharedLib/sharedView/transition/attributeInjector"),motionHandler:e("common/lib/transition/motionHandler")};var c=e("profileArea/personalDetails/mailingAddress/lib/validators/effectiveDateValidator"),u=e("profileArea/personalDetails/mailingAddress/lib/validators/endDateValidator");m.decorators={validator:e("profileArea/sharedLib/sharedView/decorators/decorator")(m,{customValidations:[e("profileArea/personalDetails/mailingAddress/lib/validators/accountSelectedValidator"),e("profileArea/personalDetails/mailingAddress/lib/validators/dirtyFormValidator"),c.MISSING_MANDATORY_DATA,c.INVALID_FORMAT,c.LESSER_THAN_CURRENT_DATE,u.MISSING_MANDATORY_DATA,u.LESSER_THAN_EFFECTIVE_DATE,u.INVALID_FORMAT,u.LESS_THAN_ONE_YEAR,e("profileArea/personalDetails/mailingAddress/lib/validators/recurrenceDateValidator")]}),screenTakeover:e("profileArea/sharedLib/sharedView/decorators/screenTakeover")},m.views={blueAlert:e("blue-ui/view/elements/alert"),blueRadiobutton:e("blue-ui/view/elements/radiobutton"),blueCheckbox:e("blue-ui/view/elements/checkbox"),blueInput:e("blue-ui/view/elements/input"),blueFieldLabel:e("blue-ui/view/elements/fieldlabel"),blueButton:e("blue-ui/view/elements/button"),blueAccessible:e("blue-ui/view/elements/accessible"),customTooltip:e("profileArea/sharedLib/sharedView/customTooltip"),styledselectWrapper:e("profileArea/sharedLib/sharedView/dashboardStyledSelectWrapper/view"),blueIconwrap:e("blue-ui/view/elements/iconwrap"),blueInlineModalHeader:e("blue-ui/view/elements/inlinemodalheader"),dashboardLink:e("profileArea/sharedLib/sharedView/dashboardLinkWrapper/view"),blueValidationDatepicker:e("blue-ui/view/modules/validationdatepicker"),blueSkiplink:e("blue-ui/view/elements/skiplink"),blueStickyfooter:e("blue-ui/view/elements/stickyfooter"),blueTooltip:e("blue-ui/view/modules/tooltip"),blueLoader:e("blue-ui/view/elements/loader"),blueLink:e("blue-ui/view/elements/link")},m.runValidation=function(e){m._isReady&&m.bridge.output.emit("runValidation",e)},m.setSkipLinkTarget=function(e){var i="mds-text-input[error-message]:not([error-message=''])",a=".validation-error-bubble[aria-hidden='false']",l=document.querySelector(i),r=document.querySelector(a);m.model.skipLinkTarget=l?i:r?a:"mds-text-input",32!==e.domEvent.keyCode&&13!==e.domEvent.keyCode||t.setFocus(d.$,m.model.skipLinkTarget)},m.syncDatepicker=function(e){if(d.util.object.get(e,"context.id")){var i=e.context.newValue,a=new Date(i);a.setDate(a.getDate()+1);var l=r(a).format("MM/DD/YYYY");m.model.mailingAddressMinimumEndDate=l;var t=e.context.id.split("mailing-address-effective-date-")[1][0];if(t){var s=m.model.mailingAddresses[t].mailingAddressEndDate,n=s&&""!==s.trim()?s:null;if(n)new Date(n)<a&&(m.model.mailingAddresses[t].mailingAddressEndDate="")}m.runValidation(e)}},m.onReady=function(){m._isReady=!0,m.bridge.output.on("state/saveMailingAddressChangesEnded",(function(e){e.node.focus()})),m.model.isXS=s.currentBreakpoint===s.BREAKPOINT.XS},m.onTeardown=function(){m._isReady=void 0}}}));